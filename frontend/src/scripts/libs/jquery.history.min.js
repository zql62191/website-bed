/*
 * jQuery history plugin
 * 
 * The MIT License
 * 
 * Copyright (c) 2006-2009 Taku Sano (Mikage Sawatari)
 * Copyright (c) 2010 Takayuki Miwa
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

(function(c){function g(a){function b(a){var h=RegExp(c.map(a,encodeURIComponent).join("|"),"ig");return function(a){return a.replace(h,decodeURIComponent)}}a=c.extend({unescape:!1},a||{});d.encoder=function(a){if(a===!0)return function(a){return a};if(typeof a=="string"&&(a=b(a.split("")))||typeof a=="function")return function(b){return a(encodeURIComponent(b))};return encodeURIComponent}(a.unescape)}var d={put:function(a,b){(b||window).location.hash=this.encoder(a)},get:function(a){a=(a||window).location.hash.replace(/^#/,
"");try{return c.browser.mozilla?a:decodeURIComponent(a)}catch(b){return a}},encoder:encodeURIComponent},e={id:"__jQuery_history",init:function(){var a='<iframe id="'+this.id+'" style="display:none" src="javascript:false;" />';c("body").prepend(a);return this},_document:function(){return c("#"+this.id)[0].contentWindow.document},put:function(a){var b=this._document();b.open();b.close();d.put(a,b)},get:function(){return d.get(this._document())}},f={base:{callback:void 0,type:void 0,check:function(){},
load:function(){},init:function(a,d){g(d);b.callback=a;b._options=d;b._init()},_init:function(){},_options:{}},timer:{_appState:void 0,_init:function(){var a=d.get();b._appState=a;b.callback(a);setInterval(b.check,100)},check:function(){var a=d.get();if(a!=b._appState)b._appState=a,b.callback(a)},load:function(a){if(a!=b._appState)d.put(a),b._appState=a,b.callback(a)}},iframeTimer:{_appState:void 0,_init:function(){var a=d.get();b._appState=a;e.init().put(a);b.callback(a);setInterval(b.check,100)},
check:function(){var a=e.get(),c=d.get();if(c!=a)c==b._appState?(b._appState=a,d.put(a),b.callback(a)):(b._appState=c,e.put(c),b.callback(c))},load:function(a){if(a!=b._appState)d.put(a),e.put(a),b._appState=a,b.callback(a)}},hashchangeEvent:{_init:function(){b.callback(d.get());c(window).bind("hashchange",b.check)},check:function(){b.callback(d.get())},load:function(a){d.put(a)}}},b=c.extend({},f.base);b.type=c.browser.msie&&(c.browser.version<8||document.documentMode<8)?"iframeTimer":"onhashchange"in
window?"hashchangeEvent":"timer";c.extend(b,f[b.type]);c.history=b})(jQuery);
